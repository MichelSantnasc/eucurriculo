<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EuCurrículo - Gerador de CV Fácil</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * { box-sizing: border-box; }
body { 
    font-family: 'Roboto', sans-serif; 
    margin: 0; padding: 0; 
    background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%); 
    min-height: 100vh; color: #333; line-height: 1.6;
}
a { color: #000; text-decoration: none; }
a:hover { text-decoration: underline; }

header {
    background-color: #000; color: #fff; padding: 20px 0; text-align: center;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}
header h1 { margin: 0; font-weight: 700; font-size: 2.2em; }
header p { margin: 5px 0 0; font-weight: 300; font-size: 0.9em; }

.container { max-width: 900px; margin: 30px auto; padding: 0 20px; }
#cv-form { background-color: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 0 20px rgba(0,0,0,0.1); }

input[type="text"], input[type="email"], input[type="url"], input[type="number"], 
input[type="tel"], select, textarea {
    width: 100%; padding: 10px 15px; margin-bottom: 10px; border: 1px solid #ccc;
    border-radius: 4px; font-size: 1em; font-family: 'Roboto', sans-serif;
    transition: border-color 0.3s;
}
input[type="file"] { padding: 8px; }
select { appearance: none; padding-right: 30px; }
input:focus, select:focus, textarea:focus { border-color: #000; outline: none; }
textarea { resize: vertical; }

label { display: block; margin-bottom: 5px; font-weight: 500; color: #333; }
.input-group { display: flex; gap: 10px; }
.input-group input, .input-group select { flex: 1; }

.accordion-section { border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px; overflow: hidden; }
.accordion-header {
    background-color: #f7f7f7; padding: 15px; cursor: pointer; display: flex;
    justify-content: space-between; align-items: center; border-bottom: 1px solid #ddd;
    transition: background-color 0.3s;
}
.accordion-section.open .accordion-header { background-color: #eee; }
.accordion-header h2 { margin: 0; font-size: 1.1em; font-weight: 500; color: #333; }
.accordion-header .arrow { transition: transform 0.3s; color: #555; }
.accordion-section.open .accordion-header .arrow { transform: rotate(180deg); }

.accordion-content {
    padding: 0 15px; max-height: 0; overflow: hidden;
    transition: max-height 0.4s ease-in-out, padding 0.3s;
}
.accordion-section.open .accordion-content { padding: 15px; }

.button-group { margin-top: 30px; display: flex; gap: 15px; justify-content: center; }
.action-btn {
    padding: 12px 25px; font-size: 1em; font-weight: 700; cursor: pointer;
    border: none; border-radius: 5px; transition: background-color 0.3s, transform 0.1s;
    color: #fff; display: flex; align-items: center; gap: 8px; flex: 1; max-width: 250px;
    justify-content: center;
}
.preview { background-color: #000; }
.preview:hover { background-color: #333; }
.download { background-color: #555; }
.download:hover { background-color: #777; }

.add-btn, .remove-btn {
    background-color: #000; color: #fff; border: none; padding: 8px 15px;
    margin-top: 10px; border-radius: 4px; cursor: pointer; font-size: 0.9em;
    display: flex; align-items: center; gap: 5px; transition: background-color 0.3s;
}
.add-btn:hover { background-color: #333; }
.remove-btn { background-color: #dc3545; padding: 6px 12px; font-size: 0.8em; }
.remove-btn:hover { background-color: #c82333; }

.telefone-item, .experiencia, .educacao-item, .idioma-item {
    border: 1px solid #ddd; padding: 15px; margin-bottom: 10px;
    border-radius: 4px; background-color: #fafafa; display: grid;
    grid-template-columns: 1fr auto; gap: 10px; align-items: center;
}
.whatsapp-checkbox { display: flex; align-items: center; gap: 5px; white-space: nowrap; }
.whatsapp-checkbox input { width: auto; margin: 0; }

.experiencia, .educacao-item, .idioma-item { display: flex; flex-wrap: wrap; gap: 10px; align-items: flex-end; }
.experiencia .cargo, .experiencia .empresa { flex: 1 1 45%; min-width: 150px; }
.experiencia .periodo-group { flex: 1 1 100%; }

.subsection-title {
    border-bottom: 1px solid #ccc; padding-bottom: 5px; margin: 10px 0 15px;
    font-size: 1em; font-weight: 500; color: #000;
}

.notification {
    position: fixed; bottom: 20px; right: 20px; padding: 15px 25px;
    border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    opacity: 0; transition: opacity 0.5s, transform 0.5s; transform: translateY(20px);
    z-index: 1000; display: flex; align-items: center; gap: 10px;
}
.notification.show { opacity: 1; transform: translateY(0); }
.notification.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
.notification.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

#preview { margin-top: 30px; padding: 30px; background-color: #fff; border: 1px solid #ddd;
    border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.05); color: #000; }
.foto-preview { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 1px solid #ccc; margin-right: 20px; }

.footer { background-color: #000; color: #fff; padding: 20px 0; margin-top: 50px; }
.footer-content { display: flex; justify-content: space-between; align-items: center; font-size: 0.9em; }
.footer-links { display: flex; gap: 20px; align-items: center; }
.footer a { color: #ccc; transition: color 0.3s; }
.footer a:hover { color: #fff; text-decoration: none; }
.donate-btn { background-color: #f7a600; color: #000 !important; padding: 8px 15px;
    border-radius: 4px; font-weight: 700; display: flex; align-items: center; gap: 5px; }

@media (max-width: 768px) {
    .input-group, .button-group { flex-direction: column; gap: 0; }
    .action-btn { max-width: 100%; }
    .telefone-item, .experiencia, .educacao-item, .idioma-item { grid-template-columns: 1fr; }
    .footer-content, .footer-links { flex-direction: column; text-align: center; gap: 10px; }
}
    </style>
</head>
<body>

    <div id="notification-success" class="notification success">
        <i class="fas fa-check-circle"></i>
    </div>
    <div id="notification-error" class="notification error">
        <i class="fas fa-times-circle"></i> <span id="error-message"></span>
    </div>

    <header>
        <h1>EuCurrículo</h1>
        <p>Gerador de CV Fácil - Crie seu currículo profissional em PDF</p>
    </header>

    <main class="container">
        <form id="cv-form">

            <!-- 1. DADOS PESSOAIS -->
            <div class="accordion-section open" id="section1">
                <div class="accordion-header" onclick="toggleSection(this)" role="button" aria-expanded="true">
                    <h2><i class="fas fa-user"></i> 1. Dados Pessoais e Contato</h2>
                    <i class="fas fa-chevron-down arrow"></i>
                </div>
                <div class="accordion-content">
                    <div class="form-group">
                        <label for="foto">Foto de Perfil (Opcional, max 2MB):</label>
                        <input type="file" id="foto" accept="image/jpeg,image/png">
                    </div>

                    <div class="input-group">
                        <input type="text" id="nome" placeholder="Nome Completo" required>
                        <input type="email" id="email" placeholder="E-mail" required>
                    </div>

                    <div class="input-group">
                        <!-- ESTADO CIVIL AGORA É SELECT -->
                        <select id="estadoCivil">
                            <option value="">-- Estado Civil (opcional) --</option>
                            <option value="Solteiro(a)">Solteiro(a)</option>
                            <option value="Casado(a)">Casado(a)</option>
                            <option value="Divorciado(a)">Divorciado(a)</option>
                            <option value="Viúvo(a)">Viúvo(a)</option>
                            <option value="União Estável">União Estável</option>
                        </select>
                        <input type="number" id="idade" placeholder="Idade (ex: 30)" min="18" max="99">
                    </div>

                    <div class="input-group">
                        <input type="text" id="cep" placeholder="CEP (ex: 59164-000)" maxlength="9" onblur="buscarCep()">
                        <input type="text" id="cidade" placeholder="Cidade" readonly>
                        <input type="text" id="uf" placeholder="UF" maxlength="2" readonly>
                    </div>

                    <input type="text" id="endereco" placeholder="Endereço (Rua, Número, Bairro - Opcional)">
                    <input type="url" id="linkedin" placeholder="Link do LinkedIn (Opcional)">

                    <label>Telefones (Mínimo 1):</label>
                    <div id="telefones">
                        <div class="telefone-item">
                            <div class="telefone-group">
                                <input type="tel" id="telefone_0" placeholder="(11) 98765-4321" class="telefone" required>
                                <label class="whatsapp-checkbox"><input type="checkbox" class="whatsapp"> WhatsApp</label>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="add-btn" onclick="adicionarTelefone()">
                        <i class="fas fa-plus-circle"></i> Adicionar Outro Telefone
                    </button>
                </div>
            </div>

            <!-- 2. OBJETIVO -->
            <div class="accordion-section" id="section2">
                <div class="accordion-header" onclick="toggleSection(this)" role="button" aria-expanded="false">
                    <h2><i class="fas fa-bullseye"></i> 2. Objetivo Profissional</h2>
                    <i class="fas fa-chevron-down arrow"></i>
                </div>
                <div class="accordion-content">
                    <textarea id="objetivo" rows="3" placeholder="Ex: Atuar na área de Logística, utilizando meus 10 anos de experiência..." required></textarea>
                </div>
            </div>

            <!-- 3. EXPERIÊNCIA PROFISSIONAL (COM PERÍODO SEPARADO) -->
            <div class="accordion-section" id="section3">
                <div class="accordion-header" onclick="toggleSection(this)" role="button" aria-expanded="false">
                    <h2><i class="fas fa-briefcase"></i> 3. Experiência Profissional</h2>
                    <i class="fas fa-chevron-down arrow"></i>
                </div>
                <div class="accordion-content">
                    <div id="experiencias">
                        <div class="experiencia">
                            <input type="text" placeholder="Cargo" class="cargo" required>
                            <input type="text" placeholder="Empresa" class="empresa" required>
                            <div class="input-group periodo-group" style="margin-top:8px;">
                                <input type="text" placeholder="Início (ex: 01/2020)" class="periodo-inicio" maxlength="7">
                                <input type="text" placeholder="Fim (ex: 12/2024 ou Atual)" class="periodo-fim" maxlength="7">
                            </div>
                            <textarea placeholder="Descrição (bullets separadas por ;)" class="descricao" rows="2"></textarea>
                        </div>
                    </div>
                    <button type="button" class="add-btn" onclick="adicionarExp()">
                        <i class="fas fa-plus-circle"></i> Adicionar Outra Experiência
                    </button>
                </div>
            </div>

            <!-- 4. FORMAÇÃO E IDIOMAS -->
            <div class="accordion-section" id="section4">
                <div class="accordion-header" onclick="toggleSection(this)" role="button" aria-expanded="false">
                    <h2><i class="fas fa-graduation-cap"></i> 4. Formação Acadêmica e Idiomas</h2>
                    <i class="fas fa-chevron-down arrow"></i>
                </div>
                <div class="accordion-content">
                    <h3 class="subsection-title">Formação Acadêmica (Mínimo 1)</h3>
                    <div id="educacoes">
                        <div class="educacao-item">
                            <select class="tipo-educacao">
                                <option value="">-- Tipo (opcional) --</option>
                                <option value="Ensino Fundamental">Ensino Fundamental</option>
                                <option value="Ensino Médio">Ensino Médio</option>
                                <option value="Graduação">Graduação</option>
                                <option value="Pós-Graduação">Pós-Graduação</option>
                                <option value="Mestrado">Mestrado</option>
                                <option value="Doutorado">Doutorado</option>
                                <option value="Curso Técnico">Curso Técnico</option>
                            </select>
                            <input type="text" placeholder="Instituição" class="instituicao" required>
                            <div class="input-group">
                                <input type="number" placeholder="Ano Início" class="ano-inicio" min="1900" max="2025">
                                <input type="number" placeholder="Ano Término" class="ano-termino" min="1900" max="2025">
                            </div>
                        </div>
                    </div>
                    <button type="button" class="add-btn" onclick="adicionarEducacao()">
                        <i class="fas fa-plus-circle"></i> Adicionar Outra Formação
                    </button>

                    <h3 class="subsection-title" style="margin-top: 20px;">Idiomas (Opcional)</h3>
                    <div id="idiomas">
                        <div class="idioma-item">
                            <input type="text" list="idiomas-lista" placeholder="Idioma (ex: Inglês)" class="idioma-nome">
                            <datalist id="idiomas-lista">
                                <option value="Inglês"><option value="Espanhol"><option value="Alemão"><option value="Francês">
                            </datalist>
                            <select class="nivel-idioma">
                                <option value="">-- Nível --</option>
                                <option value="Básico">Básico</option>
                                <option value="Intermediário">Intermediário</option>
                                <option value="Avançado">Avançado</option>
                                <option value="Fluente">Fluente</option>
                                <option value="Nativo">Nativo</option>
                            </select>
                        </div>
                    </div>
                    <button type="button" class="add-btn" onclick="adicionarIdioma()">
                        <i class="fas fa-plus-circle"></i> Adicionar Outro Idioma
                    </button>
                </div>
            </div>

            <!-- 5. HABILIDADES E ADICIONAIS -->
            <div class="accordion-section" id="section5">
                <div class="accordion-header" onclick="toggleSection(this)" role="button" aria-expanded="false">
                    <h2><i class="fas fa-tools"></i> 5. Habilidades e Adicionais</h2>
                    <i class="fas fa-chevron-down arrow"></i>
                </div>
                <div class="accordion-content">
                    <label for="skills">Habilidades (Separe por vírgula ou ponto e vírgula):</label>
                    <textarea id="skills" rows="3" placeholder="Ex: Comunicação, Liderança, JavaScript, Gestão de Projetos"></textarea>

                    <label for="adicional" style="margin-top: 15px;">Detalhes Adicionais (Opcional):</label>
                    <textarea id="adicional" rows="3" placeholder="Ex: CNH B e veículo próprio. Disponibilidade para viagens."></textarea>
                </div>
            </div>

            <div class="button-group">
                <button type="button" class="action-btn preview" onclick="previewCV()">
                    <i class="fas fa-eye"></i> Pré-visualizar CV
                </button>
                <button type="button" class="action-btn download" onclick="gerarCV()">
                    <i class="fas fa-download"></i> Gerar PDF
                </button>
            </div>
        </form>

        <div id="preview" style="display: none;"></div>
    </main>

    <footer class="footer">
        <div class="footer-content container">
            <p>© 2024 EuCurrículo. Todos os direitos reservados.</p>
            <div class="footer-links">
                <a href="https://www.instagram.com/michelsantnasc/" target="_blank" class="developer-link">Feito por Santnasc</a>
                <a href="https://pag.ae/7-eLw851" target="_blank" class="donate-btn">
                    <i class="fas fa-hand-holding-heart"></i> Me Paga um Café
                </a>
            </div>
        </div>
    </footer>

<script>
let fotoBase64 = null;

function showNotification(type, message = "Sucesso!") {
    const notif = document.getElementById(`notification-${type}`);
    const msgEl = type === 'error' ? document.getElementById('error-message') : notif;
    if (type === 'error') msgEl.textContent = message;
    else notif.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
    notif.classList.add('show');
    setTimeout(() => notif.classList.remove('show'), 5000);
}

function updateMaxHeight(sectionId) {
    const section = document.getElementById(sectionId);
    if (section && section.classList.contains('open')) {
        const content = section.querySelector('.accordion-content');
        content.style.maxHeight = (content.scrollHeight + 80) + 'px'; 
    }
}

function toggleSection(header) {
    const section = header.parentElement;
    const content = section.querySelector('.accordion-content');
    const isOpen = section.classList.contains('open');
    if (isOpen) {
        section.classList.remove('open');
        content.style.maxHeight = '0px';
        header.setAttribute('aria-expanded', 'false');
    } else {
        section.classList.add('open');
        setTimeout(() => {
            content.style.maxHeight = (content.scrollHeight + 80) + 'px';
        }, 10);
        header.setAttribute('aria-expanded', 'true');
    }
}

function maskTelefone(e) {
    let v = e.target.value.replace(/\D/g, '');
    v = v.replace(/^(\d{2})(\d)/, '($1) $2');
    v = v.replace(/(\d{5})(\d)/, '$1-$2');
    e.target.value = v.substring(0, 15);
}

function maskCEP(e) {
    let v = e.target.value.replace(/\D/g, '');
    if (v.length > 5) v = v.replace(/^(\d{5})(\d)/, '$1-$2');
    e.target.value = v.substring(0, 9);
}

function maskAno(e) {
    let v = e.target.value.replace(/\D/g, '');
    e.target.value = v.substring(0, 4);
}

document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.telefone').forEach(el => el.addEventListener('input', maskTelefone));
    document.getElementById('cep').addEventListener('input', maskCEP);
    document.querySelectorAll('.ano-inicio, .ano-termino, .periodo-inicio').forEach(el => el.addEventListener('input', maskAno));

    const first = document.querySelector('.accordion-section.open');
    if (first) updateMaxHeight(first.id);
});

document.getElementById('foto').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file && file.size > 2 * 1024 * 1024) {
        showNotification('error', 'Foto muito grande! Máximo 2MB.');
        e.target.value = '';
        return;
    }
    if (file) {
        const reader = new FileReader();
        reader.onload = e => fotoBase64 = e.target.result;
        reader.readAsDataURL(file);
    }
});

function formatarTelefone(tel) {
    const d = tel.replace(/\D/g, '');
    if (d.length === 11) return `(${d.substr(0,2)}) ${d.substr(2,5)}-${d.substr(7,4)}`;
    if (d.length === 10) return `(${d.substr(0,2)}) ${d.substr(2,4)}-${d.substr(6,4)}`;
    return tel;
}

function formatarCep(cep) {
    const d = cep.replace(/\D/g, '');
    return d.length === 8 ? `${d.substr(0,5)}-${d.substr(5,3)}` : cep;
}

function extrairAno(str) {
    return str.trim().replace(/\D/g, '').substring(0, 4);
}

function formatarPeriodoExp(inicio, fim) {
    const ini = inicio ? extrairAno(inicio) : '';
    const f = fim ? (fim.trim().toLowerCase() === 'atual' ? 'Atual' : extrairAno(fim)) : '';
    if (!ini && !f) return '';
    return (ini || '') + (ini && f ? ' – ' : '') + (f || '');
}

function buscarCep() {
    const cep = document.getElementById('cep').value.replace(/\D/g, '');
    if (cep.length !== 8) {
        document.getElementById('cidade').value = '';
        document.getElementById('uf').value = '';
        return;
    }
    fetch(`https://viacep.com.br/ws/${cep}/json/`)
        .then(r => r.json())
        .then(data => {
            if (data.erro) showNotification('error', 'CEP não encontrado!');
            else {
                document.getElementById('cidade').value = data.localidade;
                document.getElementById('uf').value = data.uf;
            }
        })
        .catch(() => showNotification('error', 'Erro ao buscar CEP.'));
}

function adicionarTelefone() {
    if (document.querySelectorAll('.telefone-item').length >= 5) return showNotification('error', 'Máximo 5 telefones!');
    const container = document.getElementById('telefones');
    const div = document.createElement('div');
    div.className = 'telefone-item';
    div.innerHTML = `
        <div class="telefone-group">
            <input type="tel" placeholder="(11) 98765-4321" class="telefone" required>
            <label class="whatsapp-checkbox"><input type="checkbox" class="whatsapp"> WhatsApp</label>
        </div>
        <button type="button" class="remove-btn" onclick="removerTelefone(this)">Remover</button>
    `;
    container.appendChild(div);
    div.querySelector('.telefone').addEventListener('input', maskTelefone);
    updateMaxHeight('section1');
}

function removerTelefone(btn) {
    if (document.querySelectorAll('.telefone-item').length <= 1) return showNotification('error', 'Mantenha pelo menos um telefone!');
    btn.parentElement.remove();
    updateMaxHeight('section1');
}

function adicionarExp() {
    const container = document.getElementById('experiencias');
    const div = document.createElement('div');
    div.className = 'experiencia';
    div.innerHTML = `
        <input type="text" placeholder="Cargo" class="cargo" required>
        <input type="text" placeholder="Empresa" class="empresa" required>
        <div class="input-group periodo-group" style="margin-top:8px; gap:15px;">
            <input type="text" placeholder="Ano Início (ex: 2020)" class="periodo-inicio" maxlength="4" style="width:110px;">
            <input type="text" placeholder="Ano Fim (ex: 2024 ou Atual)" class="periodo-fim" maxlength="7" style="width:150px;">
        </div>
        <textarea placeholder="Descrição (bullets separadas por ;)" class="descricao" rows="2"></textarea>
        <button type="button" class="remove-btn" onclick="removerExp(this)">Remover</button>
    `;
    container.appendChild(div);
    div.querySelector('.periodo-inicio').addEventListener('input', maskAno);
    updateMaxHeight('section3');
}

function removerExp(btn) {
    if (document.querySelectorAll('.experiencia').length <= 1) return showNotification('error', 'Mantenha pelo menos uma experiência!');
    btn.parentElement.remove();
    updateMaxHeight('section3');
}

function adicionarEducacao() {
    if (document.querySelectorAll('.educacao-item').length >= 5) return showNotification('error', 'Máximo 5 formações!');
    const container = document.getElementById('educacoes');
    const div = document.createElement('div');
    div.className = 'educacao-item';
    div.innerHTML = `
        <select class="tipo-educacao">
            <option value="">-- Tipo (opcional) --</option>
            <option value="Ensino Fundamental">Ensino Fundamental</option>
            <option value="Ensino Médio">Ensino Médio</option>
            <option value="Graduação">Graduação</option>
            <option value="Pós-Graduação">Pós-Graduação</option>
            <option value="Mestrado">Mestrado</option>
            <option value="Doutorado">Doutorado</option>
            <option value="Curso Técnico">Curso Técnico</option>
        </select>
        <input type="text" placeholder="Instituição" class="instituicao" required>
        <div class="input-group" style="gap:15px;">
            <input type="text" placeholder="Ano Início" class="ano-inicio" maxlength="4" style="width:120px;">
            <input type="text" placeholder="Ano Fim" class="ano-termino" maxlength="4" style="width:120px;">
        </div>
        <button type="button" class="remove-btn" onclick="removerEducacao(this)">Remover</button>
    `;
    container.appendChild(div);
    div.querySelectorAll('.ano-inicio, .ano-termino').forEach(el => el.addEventListener('input', maskAno));
    updateMaxHeight('section4');
}

function removerEducacao(btn) {
    if (document.querySelectorAll('.educacao-item').length <= 1) return showNotification('error', 'Mantenha pelo menos uma formação!');
    btn.parentElement.remove();
    updateMaxHeight('section4');
}

function adicionarIdioma() {
    if (document.querySelectorAll('.idioma-item').length >= 5) return showNotification('error', 'Máximo 5 idiomas!');
    const container = document.getElementById('idiomas');
    const div = document.createElement('div');
    div.className = 'idioma-item';
    div.innerHTML = `
        <input type="text" list="idiomas-lista" placeholder="Idioma" class="idioma-nome">
        <select class="nivel-idioma">
            <option value="">-- Nível --</option>
            <option value="Básico">Básico</option>
            <option value="Intermediário">Intermediário</option>
            <option value="Avançado">Avançado</option>
            <option value="Fluente">Fluente</option>
            <option value="Nativo">Nativo</option>
        </select>
        <button type="button" class="remove-btn" onclick="removerIdioma(this)">Remover</button>
    `;
    container.appendChild(div);
    updateMaxHeight('section4');
}

function removerIdioma(btn) {
    if (document.querySelectorAll('.idioma-item').length <= 1) return;
    btn.parentElement.remove();
    updateMaxHeight('section4');
}

function validarForm() {
    if (!document.getElementById('nome').value.trim()) return showNotification('error', 'Preencha o nome!'), false;
    if (!document.getElementById('email').value.includes('@')) return showNotification('error', 'E-mail inválido!'), false;
    return true;
}

function previewCV() {
    if (!validarForm()) return;
    const p = document.getElementById('preview');
    let html = `<h2 style="text-align:center;border-bottom:2px solid #000;padding-bottom:10px;color:#000;">PRÉ-VISUALIZAÇÃO DO CURRÍCULO</h2>`;

    html += '<div style="display:flex;align-items:flex-start;margin-bottom:20px;">';
    if (fotoBase64) html += `<img src="${fotoBase64}" class="foto-preview" style="margin-right:20px;">`;
    html += `<div><h3 style="margin:0;color:#000;">${document.getElementById('nome').value.toUpperCase()}</h3>`;
    const civil = document.getElementById('estadoCivil').value;
    const idade = document.getElementById('idade').value;
    if (civil || idade) html += `<br><small>${civil}${civil && idade ? ', ' : ''}${idade ? idade + ' anos' : ''}</small>`;
    const addr = [formatarCep(document.getElementById('cep').value), document.getElementById('endereco').value, document.getElementById('cidade').value, document.getElementById('uf').value].filter(Boolean).join(' – ');
    if (addr) html += `<br><small>${addr}</small>`;
    html += '</div></div>';

    html += `<p><strong>E-mail:</strong> ${document.getElementById('email').value}</p>`;
    let tels = '<p><strong>Telefones:</strong> ';
    document.querySelectorAll('.telefone').forEach((t, i, arr) => {
        if (t.value) {
            const wa = t.closest('.telefone-group')?.querySelector('.whatsapp')?.checked ?? false;
            tels += formatarTelefone(t.value) + (wa ? ' (WhatsApp)' : '') + (i < arr.length-1 ? ', ' : '');
        }
    });
    html += tels + '</p>';
    if (document.getElementById('linkedin').value) html += `<p><strong>LinkedIn:</strong> ${document.getElementById('linkedin').value}</p>`;

    const obj = document.getElementById('objetivo').value.trim();
    if (obj) html += `<h4 style="border-bottom:1px solid #000;padding-bottom:5px;margin-top:20px;">OBJETIVO</h4><p style="text-transform:uppercase;">${obj}</p>`;

    if ([...document.querySelectorAll('.experiencia')].some(e => e.querySelector('.cargo').value.trim())) {
        html += `<h4 style="border-bottom:1px solid #000;padding-bottom:5px;margin-top:20px;">EXPERIÊNCIA PROFISSIONAL</h4>`;
        document.querySelectorAll('.experiencia').forEach(exp => {
            const cargo = exp.querySelector('.cargo').value.trim();
            if (!cargo) return;
            const empresa = exp.querySelector('.empresa').value.trim();
            const periodo = formatarPeriodoExp(exp.querySelector('.periodo-inicio').value, exp.querySelector('.periodo-fim').value);
            const desc = exp.querySelector('.descricao').value.split(';').map(d => d.trim()).filter(Boolean);
            html += `<h5 style="margin-top:15px;">${cargo.toUpperCase()}</h5><p><strong>${empresa}</strong>${periodo ? ' | ' + periodo : ''}</p>`;
            if (desc.length) { html += '<ul>'; desc.forEach(b => html += `<li>${b}</li>`); html += '</ul>'; }
        });
    }

    if ([...document.querySelectorAll('.educacao-item')].some(e => e.querySelector('.instituicao').value.trim())) {
        html += `<h4 style="border-bottom:1px solid #000;padding-bottom:5px;margin-top:20px;">FORMAÇÃO ACADÊMICA</h4><ul>`;
        document.querySelectorAll('.educacao-item').forEach(item => {
            const tipo = item.querySelector('.tipo-educacao').value;
            const inst = item.querySelector('.instituicao').value.trim();
            const ini = item.querySelector('.ano-inicio').value.trim();
            const fim = item.querySelector('.ano-termino').value.trim();
            if (inst) {
                let texto = tipo ? tipo + ' – ' + inst : inst;
                if (ini || fim) texto += ` (${ini || ''}${ini && fim ? ' – ' : ''}${fim || ''})`;
                html += `<li>${texto}</li>`;
            }
        });
        html += '</ul>';
    }

    const idiomas = document.querySelectorAll('.idioma-item');
    if ([...idiomas].some(i => i.querySelector('.idioma-nome').value.trim())) {
        html += `<h4 style="border-bottom:1px solid #000;padding-bottom:5px;margin-top:20px;">IDIOMAS</h4><ul>`;
        idiomas.forEach(i => {
            const nome = i.querySelector('.idioma-nome').value.trim();
            const nivel = i.querySelector('.nivel-idioma').value;
            if (nome) html += `<li><strong>${nome}</strong> - ${nivel || 'Não informado'}</li>`;
        });
        html += '</ul>';
    }

    const skills = document.getElementById('skills').value.trim();
    if (skills) html += `<h4 style="border-bottom:1px solid #000;padding-bottom:5px;margin-top:20px;">HABILIDADES</h4><p>${skills.replace(/;/g, ', ')}</p>`;

    const adicional = document.getElementById('adicional').value.trim();
    if (adicional) html += `<h4 style="border-bottom:1px solid #000;padding-bottom:5px;margin-top:20px;">DETALHES ADICIONAIS</h4><p>${adicional}</p>`;

    p.innerHTML = html;
    p.style.display = 'block';
    p.scrollIntoView({ behavior: 'smooth' });
}

function gerarCV() {
    if (!validarForm()) return;
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF('p', 'mm', 'a4');
    doc.setFont('times');
    let y = 20;

    if (fotoBase64) doc.addImage(fotoBase64, 'JPEG', 15, y, 25, 30);

    doc.setFontSize(26);
    doc.setFont('times', 'bold');
    doc.text(document.getElementById('nome').value.toUpperCase(), fotoBase64 ? 45 : 20, y + 10);
    y += 25;

    doc.setFontSize(10.5);
    doc.setFont('times', 'normal');
    const baseX = fotoBase64 ? 45 : 20;

    const civil = document.getElementById('estadoCivil').value;
    const idade = document.getElementById('idade').value;
    if (civil || idade) { doc.text(`${civil}${civil && idade ? ', ' : ''}${idade ? idade + ' anos' : ''}`, baseX, y); y += 6; }

    const addr = [formatarCep(document.getElementById('cep').value), document.getElementById('endereco').value, document.getElementById('cidade').value, document.getElementById('uf').value].filter(Boolean).join(' – ');
    if (addr) { doc.text(addr, baseX, y); y += 6; }

    doc.text('E-mail: ' + document.getElementById('email').value, baseX, y); y += 6;

    let telText = 'Telefones: ';
    document.querySelectorAll('.telefone').forEach((t, i, arr) => {
        if (t.value) {
            const wa = t.closest('.telefone-group')?.querySelector('.whatsapp')?.checked ?? false;
            telText += formatarTelefone(t.value) + (wa ? ' (WhatsApp)' : '') + (i < arr.length-1 ? ', ' : '');
        }
    });
    const telLines = doc.splitTextToSize(telText, 160);
    telLines.forEach(l => { doc.text(l, baseX, y); y += 5; });

    if (document.getElementById('linkedin').value) { doc.text('LinkedIn: ' + document.getElementById('linkedin').value, baseX, y); y += 8; }
    y += 10;

    const addSection = (title) => {
        doc.setFontSize(14); doc.setFont('times', 'bold');
        doc.text(title, 20, y); doc.line(20, y + 1, 190, y + 1); y += 8;
        doc.setFontSize(11.5); doc.setFont('times', 'normal');
    };

    const obj = document.getElementById('objetivo').value.trim();
    if (obj) {
        addSection('OBJETIVO');
        doc.setFont('times', 'bold');
        doc.splitTextToSize(obj.toUpperCase(), 170).forEach(l => { doc.text(l, 20, y); y += 7; });
        y += 5; doc.setFont('times', 'normal');
    }

    if ([...document.querySelectorAll('.experiencia')].some(e => e.querySelector('.cargo').value.trim())) {
        addSection('EXPERIÊNCIA PROFISSIONAL');
        document.querySelectorAll('.experiencia').forEach(exp => {
            const cargo = exp.querySelector('.cargo').value.trim();
            if (!cargo) return;
            doc.setFont('times', 'bold'); doc.text(cargo.toUpperCase(), 20, y); y += 7;
            const empresa = exp.querySelector('.empresa').value.trim();
            const periodo = formatarPeriodoExp(exp.querySelector('.periodo-inicio').value, exp.querySelector('.periodo-fim').value);
            doc.setFont(empresa ? 'times': 'bold' , 'times', 'normal');
            doc.text(empresa + (periodo ? ' | ' + periodo : ''), 20, y); y += 7;
            const desc = exp.querySelector('.descricao').value.split(';').map(d => d.trim()).filter(Boolean);
            desc.forEach(b => {
                doc.splitTextToSize('• ' + b, 165).forEach(l => { doc.text(l, 25, y); y += 5; });
            });
            y += 8;
            if (y > 280) { doc.addPage(); y = 20; }
        });
    }

    if ([...document.querySelectorAll('.educacao-item')].some(e => e.querySelector('.instituicao').value.trim())) {
        addSection('FORMAÇÃO ACADÊMICA');
        document.querySelectorAll('.educacao-item').forEach(item => {
            const tipo = item.querySelector('.tipo-educacao').value;
            const inst = item.querySelector('.instituicao').value.trim();
            const ini = item.querySelector('.ano-inicio').value.trim();
            const fim = item.querySelector('.ano-termino').value.trim();
            if (!inst) return;
            let texto = tipo ? tipo + ' – ' + inst : inst;
            if (ini || fim) texto += ` (${ini || ''}${ini && fim ? ' – ' : ''}${fim || ''})`;
            doc.splitTextToSize(texto, 170).forEach(l => { doc.text(l, 20, y); y += 6; });
        });
        y += 5;
    }

    const idiomas = document.querySelectorAll('.idioma-item');
    if ([...idiomas].some(i => i.querySelector('.idioma-nome').value.trim())) {
        addSection('IDIOMAS');
        idiomas.forEach(i => {
            const nome = i.querySelector('.idioma-nome').value.trim();
            const nivel = i.querySelector('.nivel-idioma').value;
            if (nome) doc.text(`${nome} - ${nivel || 'Não informado'}`, 20, y), y += 6;
        });
        y += 5;
    }

    const skills = document.getElementById('skills').value.trim();
    if (skills) {
        addSection('HABILIDADES');
        doc.splitTextToSize(skills.replace(/;/g, ', '), 170).forEach(l => { doc.text(l, 20, y); y += 6; });
        y += 5;
    }

    const adicional = document.getElementById('adicional').value.trim();
    if (adicional) {
        addSection('DETALHES ADICIONAIS');
        doc.splitTextToSize(adicional, 170).forEach(l => { doc.text(l, 20, y); y += 6; });
    }

    const nomeArquivo = `Curriculo_${document.getElementById('nome').value.replace(/[^a-zA-Z0-9]/g, '_')}_Classico.pdf`;
    doc.save(nomeArquivo);
    showNotification('success', 'Currículo gerado com sucesso!');
}
</script>
</body>
</html>
